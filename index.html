<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nebula Lite v1.5</title>
    <style>
        body { background: #010101; color: #00d4ff; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 15px; margin: 0; overflow-x: hidden; }
        .container { max-width: 380px; margin: auto; border: 1px solid #004466; padding: 20px; border-radius: 15px; background: #050505; box-shadow: 0 0 15px rgba(0, 212, 255, 0.1); }
        h2 { letter-spacing: 2px; font-weight: 300; margin: 0 0 5px 0; font-size: 1.5rem; }
        .version { font-size: 9px; color: #0088cc; margin-bottom: 15px; text-transform: uppercase; }
        input { width: 100%; padding: 10px; margin: 6px 0; background: #111; border: 1px solid #222; color: #fff; border-radius: 8px; box-sizing: border-box; text-align: center; font-size: 14px; }
        input:focus { border-color: #00d4ff; outline: none; }
        .btn-group { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
        button { flex: 1; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 13px; }
        .btn-enc { background: #006699; }
        .btn-dec { background: #004466; border: 1px solid #00d4ff; }
        .btn-reset { background: #440000; border: 1px solid #ff4444; width: 100%; margin-top: 8px; }
        button:active { transform: scale(0.95); }
        #result-box { margin-top: 15px; padding: 10px; border-top: 1px solid #222; min-height: 80px; display: flex; flex-direction: column; justify-content: center; }
        .label-hasil { font-size: 10px; color: #555; text-transform: uppercase; margin-bottom: 5px; }
        /* Teks Hasil & Warning Proporsional */
        #result { font-size: 16px; color: #00ff88; font-family: 'Courier New', monospace; word-break: break-all; line-height: 1.4; }
        .warning { color: #ff4444 !important; font-size: 13px !important; }
    </style>
</head>
<body>

    <div class="container">
        <h2>NEBULA LITE</h2>
        <div class="version">V1.5 - FINAL RULE APPLIED</div>
        
        <input type="text" id="inputString" placeholder="Pesan" autocomplete="off" spellcheck="false">
        <input type="text" id="key" placeholder="Master Key" autocomplete="off" spellcheck="false">
        <input type="text" id="shift" placeholder="Shift (S)" autocomplete="off">
        
        <div class="btn-group">
            <button class="btn-enc" onclick="process(true)">ENKRIPSI</button>
            <button class="btn-dec" onclick="process(false)">DEKRIPSI</button>
            <button class="btn-reset" onclick="selfDestruct()">RESET</button>
        </div>

        <div id="result-box">
            <div class="label-hasil" id="status-label">SIAGA</div>
            <div id="result">...</div>
        </div>
    </div>

    <script>
        function process(isEncrypt) {
            let pRaw = document.getElementById('inputString').value;
            let kRaw = document.getElementById('key').value;
            let sRaw = document.getElementById('shift').value;
            
            let errors = [];

            // --- VALIDASI PESAN ---
            if (pRaw.length === 0) errors.push("pesan minimal 3 karakter");
            else if (pRaw.length < 3) errors.push("pesan minimal 3 karakter");
            else if (pRaw.length > 35) errors.push("pesan max 35 karakter");

            // --- VALIDASI MASTER KEY ---
            if (kRaw.length === 0) errors.push("key minimal 6 karakter");
            else if (kRaw.length < 6) errors.push("key minimal 6 karakter");
            else if (kRaw.length > 6) errors.push("key max 6 karakter");
            if (kRaw.length > 0 && !/^[a-zA-Z]+$/.test(kRaw)) errors.push("master key harus huruf");

            // --- VALIDASI SHIFT (S) ---
            if (sRaw.length === 0) errors.push("shift (S) minimal 1 angka");
            else if (sRaw.length > 6) errors.push("shift (S) max 6 karakter");
            if (sRaw.length > 0 && !/^\d+$/.test(sRaw)) errors.push("shift harus angka");

            let resultDiv = document.getElementById('result');
            let label = document.getElementById('status-label');

            // Tampilkan SEMUA error jika ada
            if (errors.length > 0) {
                label.innerText = "PERINGATAN SISTEM:";
                resultDiv.innerText = errors.join(" | "); // Dipisahkan dengan garis vertikal agar rapi
                resultDiv.classList.add('warning');
                return;
            }

            // --- PROSES JIKA VALID ---
            let k = kRaw.length;
            let s = parseInt(sRaw);
            let output = "";
            let n = 1;
            let inputUpper = pRaw.toUpperCase();

            for (let i = 0; i < inputUpper.length; i++) {
                let char = inputUpper[i];
                let code = char.charCodeAt(0);
                if (code >= 65 && code <= 90) {
                    let p = code - 64;
                    let res = isEncrypt ? (p + k + n + s) % 26 : (p - k - n - s) % 26;
                    while (res <= 0) res += 26;
                    if (res === 0) res = 26;
                    output += String.fromCharCode(res + 64);
                } else {
                    output += char;
                }
                n++;
            }

            label.innerText = isEncrypt ? "HASIL ENKRIPSI:" : "HASIL DEKRIPSI:";
            resultDiv.innerText = output;
            resultDiv.classList.remove('warning');
        }

        function selfDestruct() {
            document.getElementById('inputString').value = "";
            document.getElementById('key').value = "";
            document.getElementById('shift').value = "";
            document.getElementById('result').innerText = "...";
            document.getElementById('result').classList.remove('warning');
            document.getElementById('status-label').innerText = "SIAGA";
        }
    </script>
</body>
</html>